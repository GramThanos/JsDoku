/*
 * Jsdoku v1.0.0-beta
 */

var Jsdoku=function(){function g(a,b,c){this.type="number"==typeof b?a:3;this.level="number"==typeof b?b:g.level.HARD;this.efford=c||Math.ceil((this.level/g.level.HARD*1.5+.5)*Math.pow(this.type,4));this.generated=new g.Generator(this.type);this.desolved=new g.DeSolver(this.generated.grid,this.level,this.efford);this.grid=this.desolved.grid;this.solved=this.desolved.solved}function h(a,b){this.init(a,b);this.generate()}function m(a,b){this.init(a,b);this.solve()}function n(a,b,c){this.init(a,b,c);
this.deSolve()}g.version="v1.0.0-beta";g.level={SUPER_EASY:0,EASY:1,MEDIUM:2,HARD:3};h.prototype.init=function(a,b){b=b||!1;this.N=a;this.N_Square=this.N*this.N;this.stats={};this.keys=[];var c;for(c=1;c<=this.N_Square;c++)this.keys.push(c);this.predefined=b?!0:!1;this.grid=[];var d;if(this.predefined)for(this.predefined_grid=[],d=0;d<this.N_Square;d++)this.predefined_grid.push(b[d].slice(0)),this.grid.push(b[d].slice(0));else for(d=0;d<this.N_Square;d++)for(this.grid.push([]),c=0;c<this.N_Square;c++)this.grid[d].push(!1)};
h.prototype.generate=function(){this.stats.rounds=0;this.stats.started=(new Date).getTime();do{this.clearGrid();var a=this.tryToGenerate();this.stats.rounds++}while(!a);this.stats.ended=(new Date).getTime();this.stats.took=this.stats.ended-this.stats.started};h.prototype.clearGrid=function(){var a,b;if(this.predefined)for(b=0;b<this.N_Square;b++)for(a=0;a<this.N_Square;a++)this.grid[b][a]=this.predefined_grid[b][a];else for(b=0;b<this.N_Square;b++)for(a=0;a<this.N_Square;a++)this.grid[b][a]=!1};h.prototype.tryToGenerate=
function(){var a,b,c=0;if(this.predefined)for(a=0;a<this.N;a++)this.fillBoxBruteForce(a,a),c++;else for(a=0;a<this.N;a++)this.randomizeBox(a,a),c++;a=0;for(b=this.N-1;a<this.N;a++,b--)if(a!=b){if(!this.fillBoxBruteForce(b,a))return!1;c++}for(var d=0;c<this.N_Square;){d++;a=d;for(b=0;a<this.N&&b<this.N;a++,b++){if(!this.fillBoxBruteForce(b,a))return!1;c++}a=0;for(b=d;a<this.N&&b<this.N;a++,b++){if(!this.fillBoxBruteForce(b,a))return!1;c++}}return!0};h.prototype.randomizeBox=function(a,b){a*=this.N;
b*=this.N;var c=this.keys.slice(0);q(c);var d=0,e,f;for(e=0;e<this.N;e++)for(f=0;f<this.N;f++)this.grid[a+f][b+e]=c[d],d++;return!0};h.prototype.fillBoxBruteForce=function(a,b){var c=a*this.N,d=b*this.N,e,f,l=[];for(e=0;e<this.N;e++)for(f=0;f<this.N;f++){var k={y:c+f,x:d+e};0==this.grid[k.y][k.x]&&l.push(k)}if(0==l.length)return!0;c=l.slice(0);q(l);if(!this.fillDefinedCells(l))return!1;for(d=0;0<l.length;)if(k=l.shift(),0==this.grid[k.y][k.x]&&(k.candidates||(k.candidates=this.getCandidates(k.y,k.x)),
f=k.candidates,0<f.length&&(this.grid[k.y][k.x]=f[Math.floor(Math.random()*f.length)],this.fillDefinedCells(l,[this.grid[k.y][k.x]])||(f=[])),0==f.length)){d++;if(d>this.N*Math.pow(this.N,this.N))return!1;l=c.slice(0);for(f=0;f<l.length;f++)this.grid[l[f].y][l[f].x]=!1,this.grid[l[f].y][l[f].x].candidates=!1;q(l)}return!0};h.prototype.fillDefinedCells=function(a,b){if(0==a.length)return!0;var c;if(!a[0].candidates)for(c=a.length-1;0<=c;c--)a[c].candidates=this.getCandidates(a[c].y,a[c].x);q(a);b=
b||[];for(c=a.length;0!=c;){var d=a.shift();c--;for(var e=d,f=d.candidates,l=b,k=[],g=f.length-1;0<=g;g--)-1==l.indexOf(f[g])&&k.push(f[g]);e.candidates=k;if(0==d.candidates.length)return!1;1==d.candidates.length?(b.push(d.candidates[0]),this.grid[d.y][d.x]=d.candidates[0],c=a.length):a.push(d)}return!0};h.prototype.getCandidates=function(a,b){var c=this.getColumn(b),d=this.getRow(a),e=this.getBox(a,b);c=[].concat(c).concat(d).concat(e);d=this.keys.slice(0);for(e=d.length-1;0<=e;e--)-1<c.indexOf(d[e])&&
d.splice(e,1);return d};h.prototype.getColumn=function(a){for(var b=[],c=0;c<this.grid.length;c++)b.push(this.grid[c][a]);return b};h.prototype.getRow=function(a){for(var b=[],c=0;c<this.grid.length;c++)b.push(this.grid[a][c]);return b};h.prototype.getBox=function(a,b){b-=b%this.N;a-=a%this.N;var c=[],d,e;for(d=b;d<b+this.N;d++)for(e=a;e<a+this.N;e++)c.push(this.grid[e][d]);return c};g.Generator=h;m.prototype.init=function(a,b){this.N=Math.floor(Math.sqrt(a.length));this.N_Square=this.N*this.N;this.level=
b;this.stats={};var c;this.keys=[];for(c=1;c<=this.N_Square;c++)this.keys.push(c);this.grid=[];for(c=0;c<a.length;c++)this.grid.push(a[c].slice(0))};m.prototype.solve=function(){this.stats.rounds=0;this.stats.moves={super_easy:0,easy:0,medium:0};this.stats.started=(new Date).getTime();this.success=this.loopSolve();this.stats.ended=(new Date).getTime();this.stats.took=this.stats.ended-this.stats.started};m.prototype.loopSolve=function(){for(var a=this.getEmptyCells(),b=0,c=!0;a.length;)if(this.stats.rounds++,
this.solveCell(a[b])?(a.splice(b,1),c=!1):b++,b==a.length){if(c)break;b=0;c=!0}return 0==a.length?!0:!1};m.prototype.solveCell=function(a){return p.super_easy.lastEmptyCellRow.apply(this,[a])||p.super_easy.lastEmptyCellColumn.apply(this,[a])||p.super_easy.lastEmptyCellBox.apply(this,[a])?(this.stats.moves.super_easy++,!0):this.level<=g.level.SUPER_EASY?!1:p.easy.singleRowColumnBoxCandidate.apply(this,[a])?(this.stats.moves.easy++,!0):this.level<=g.level.EASY?!1:p.medium.singleCellBoxPossibleCandidate.apply(this,
[a])?(this.stats.moves.medium++,!0):!1};m.prototype.getEmptyCells=function(){for(var a=[],b=0;b<this.N_Square;b++)for(var c=0;c<this.N_Square;c++)!1===this.grid[b][c]&&a.push({y:b,x:c});return a};m.prototype.getCandidates=h.prototype.getCandidates;m.prototype.getColumn=h.prototype.getColumn;m.prototype.getRow=h.prototype.getRow;m.prototype.getBox=h.prototype.getBox;m.prototype.getColumnCandidates=function(a){for(var b=this.keys.slice(0),c,d=0;d<this.grid.length;d++)c=b.indexOf(this.grid[d][a]),-1<
c&&b.splice(c,1);return b};m.prototype.getRowCandidates=function(a){for(var b=this.keys.slice(0),c,d=0;d<this.grid.length;d++)c=b.indexOf(this.grid[a][d]),-1<c&&b.splice(c,1);return b};g.Solver=m;var p={super_easy:{lastEmptyCellRow:function(a){var b=[],c=0,d;for(d=0;d<this.grid.length;d++)if(0!=this.grid[a.y][d])b.push(this.grid[a.y][d]);else if(c++,1<c)return!1;if(b.length+1==this.grid.length)for(d=0;d<this.keys.length;d++)if(-1==b.indexOf(this.keys[d]))return this.grid[a.y][a.x]=this.keys[d],!0;
return!1},lastEmptyCellColumn:function(a){var b=[],c=0,d;for(d=0;d<this.grid.length;d++)if(0!=this.grid[d][a.x])b.push(this.grid[d][a.x]);else if(c++,1<c)return!1;if(b.length+1==this.grid.length)for(d=0;d<this.keys.length;d++)if(-1==b.indexOf(this.keys[d]))return this.grid[a.y][a.x]=this.keys[d],!0;return!1},lastEmptyCellBox:function(a){for(var b=a.x-a.x%this.N,c=a.y-a.y%this.N,d=[],e=0,f=b;f<b+this.N;f++)for(var g=c;g<c+this.N;g++)if(0!=this.grid[g][f])d.push(this.grid[g][f]);else if(e++,1<e)return!1;
if(d.length+1==this.grid.length)for(b=0;b<this.keys.length;b++)if(-1==d.indexOf(this.keys[b]))return this.grid[a.y][a.x]=this.keys[b],!0;return!1}},easy:{singleRowColumnBoxCandidate:function(a){var b=this.getCandidates(a.y,a.x);return 1==b.length?(this.grid[a.y][a.x]=b[0],!0):!1}},medium:{singleCellBoxPossibleCandidate:function(a){var b=a.x-a.x%this.N,c=a.y-a.y%this.N,d=this.keys.slice(0),e,f;for(e=b;e<b+this.N;e++)for(f=c;f<c+this.N;f++)0!=this.grid[f][e]&&d.splice(d.indexOf(this.grid[f][e]),1);
for(e=b;e<b+this.N;e++)if(e!=a.x){var g=this.getColumnCandidates(e);for(h=0;h<g.length;h++){var k=d.indexOf(g[h]);-1!=k&&d.splice(k,1)}}if(1==d.length)return this.grid[a.y][a.x]=d[0],!0;for(f=c;f<c+this.N;f++)if(f!=a.y){g=this.getColumnCandidates(f);for(var h=0;h<g.length;h++)k=d.indexOf(g[h]),-1!=k&&d.splice(k,1)}return 1==d.length?(this.grid[a.y][a.x]=d[0],!0):!1}}};n.prototype.init=function(a,b,c){this.N=Math.floor(Math.sqrt(a.length));this.N_Square=this.N*this.N;this.level=b;this.efford=c;this.stats=
{};this.keys=[];for(b=1;b<=this.N_Square;b++)this.keys.push(b);this.grid=[];for(b=0;b<this.N_Square;b++)this.grid.push(a[b].slice(0))};n.prototype.deSolve=function(){this.stats.rounds=0;this.stats.removed=0;this.stats.started=(new Date).getTime();this.loopDeSolve();this.stats.fillpercent=1-this.stats.removed/(this.N_Square*this.N_Square);this.stats.fillpercent=Math.round(100*this.stats.fillpercent);window.g2=this.grid;this.solved=new m(this.grid,this.level);this.stats.moves=this.solved.stats.moves;
this.stats.ended=(new Date).getTime();this.stats.took=this.stats.ended-this.stats.started};n.prototype.loopDeSolve=function(){for(var a=this.getFilledCells(),b,c,d,e=this.efford,f;0<e;)this.stats.rounds++,c=Math.floor(Math.random()*a.length),b=a[c],d=this.grid[b.y][b.x],this.grid[b.y][b.x]=!1,f=new m(this.grid,this.level),f.success?(a.splice(c,1),this.stats.removed++):(this.grid[b.y][b.x]=d,e--);return!0};n.prototype.getFilledCells=function(){for(var a=[],b=0;b<this.N_Square;b++)for(var c=0;c<this.N_Square;c++)!1!==
this.grid[b][c]&&a.push({y:b,x:c});return a};g.DeSolver=n;g.format=function(a){return"string"===typeof a?g.format_stringToMatrix(a):"object"===typeof a?g.format_matrixToString(a):null};g.format_stringToMatrix=function(a){var b=Math.sqrt(a.length),c=[],d,e,f=0;for(e=0;e<b;e++)for(c.push([]),d=0;d<b;d++)c[e].push(g.format_charToValue(a[f])),f++;return c};g.format_matrixToString=function(a){var b=a.length,c="",d,e;for(e=0;e<b;e++)for(d=0;d<b;d++)c+=g.format_valueToChar(a[e][d]);return c};g.format_stringToShortString=
function(a){a=a.replace(/_-/g,".");for(var b="",c=0,d=0;d<a.length;d++)"."===a[d]?(c++,16==c&&(c=1,b+="+F")):(1==c?(b+=".",c=0):1<c&&(b+="+"+c.toString(16),c=0),b+=a[d]);return b};g.format_shortStringToString=function(a){for(var b="",c=0,d;c<a.length;){if("+"===a[c])for(c++,d=parseInt(a[c],16)-1;0<=d;d--)b+=".";else b+=a[c];c++}return b};g.format_charToValue=function(a){return"."===a||"_"===a||"-"===a?!1:a==parseInt(a,16)?parseInt(a,16):null};g.format_valueToChar=function(a){return"number"===typeof a?
a.toString(16):!1===a?".":" "};var q=function(a){var b;for(b=a.length-1;0<b;b--){var c=Math.floor(Math.random()*(b+1));var d=a[b];a[b]=a[c];a[c]=d}};return g}();
